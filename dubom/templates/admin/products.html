{% extends "base.html" %}
{% block content %}
<h3 class="mb-3">Produtos</h3>

<div class="row">
  <!-- Formulário de cadastro -->
  <div class="col-12 col-lg-4 mb-3">
    <div class="card p-3">
      <form method="post" action="/admin/products/create">
        <div class="mb-2"><input name="name" class="form-control" placeholder="Nome" required></div>
        <div class="mb-2"><input name="price" class="form-control" placeholder="Preço" required></div>
        <div class="mb-2"><input name="image" class="form-control" placeholder="URL da imagem"></div>
        <div class="mb-2"><input name="marketplace_shopee" class="form-control" placeholder="URL Shopee"></div>
        <div class="mb-2"><input name="marketplace_mercadolivre" class="form-control" placeholder="URL MercadoLivre"></div>
        <div class="mb-2"><textarea name="description" class="form-control" placeholder="Descrição"></textarea></div>
        <button class="btn btn-success w-100">Adicionar produto</button>
      </form>
    </div>
  </div>

  <!-- Tabela de produtos -->
  <div class="col-12 col-lg-8">
    <div class="table-responsive">
      <table class="table table-striped table-sm">
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Preço</th>
            <th>Descrição</th>
            <th>Imagem</th>
            <th>Shopee</th>
            <th>MercadoLivre</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {% for p in products %}
          <tr>
            <!-- Form de update separado -->
            <form id="form-update-{{p.id}}" method="post" action="/admin/products/update/{{p.id}}">
              <td>{{p.id}}</td>
              <td><input name="name" class="form-control form-control-sm" value="{{p.name}}"></td>
              <td><input name="price" class="form-control form-control-sm" value="{{'%.2f'|format(p.price)}}"></td>
              <td><textarea name="description" class="form-control form-control-sm">{{p.description or ''}}</textarea></td>
              <td><input name="image" class="form-control form-control-sm" value="{{p.image or ''}}"></td>
              <td><input name="marketplace_shopee" class="form-control form-control-sm" value="{{p.marketplace_shopee or ''}}"></td>
              <td><input name="marketplace_mercadolivre" class="form-control form-control-sm" value="{{p.marketplace_mercadolivre or ''}}"></td>
              <td class="d-flex flex-wrap gap-1">
                <button type="submit" class="btn btn-sm btn-primary flex-grow-1">Salvar</button>
                <a class="btn btn-sm btn-outline-secondary flex-grow-1" href="/product/{{p.id}}" target="_blank">Ver</a>
              </td>
            </form>
            <!-- Form de delete separado -->
            <form id="form-delete-{{p.id}}" method="post" action="/admin/products/delete/{{p.id}}" style="display:inline" onsubmit="return confirm('Deseja realmente deletar este produto?');">
              <td colspan="1">
                <button class="btn btn-sm btn-danger w-100 mt-1 mt-lg-0">Deletar</button>
              </td>
            </form>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
